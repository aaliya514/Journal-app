@page "/settings"
@inject JournalService JournalService
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
<div style="min-height: 100vh; padding: 2rem;">
    <div style="max-width: 900px; margin: 0 auto;">

        <div style="background: white; border-radius: 24px; padding: 2.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">

            <h1 style="font-size: 2rem; font-weight: 700; color: #6366f1; margin-bottom: 2rem;">Settings</h1>

            <div style="background: #f8fafc; padding: 2rem; border-radius: 16px; margin-bottom: 2rem;">
                <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Theme</h2>
                <div style="display: flex; gap: 1rem;">
                    @if (currentTheme == "light")
                    {
                        <button @onclick="SetLightTheme" style="padding: 0.75rem 1.5rem; background: #6366f1; color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;">Light</button>
                    }
                    else
                    {
                        <button @onclick="SetLightTheme" style="padding: 0.75rem 1.5rem; background: white; color: #64748b; border: 2px solid #e2e8f0; border-radius: 12px; font-weight: 600; cursor: pointer;">Light</button>
                    }

                    @if (currentTheme == "dark")
                    {
                        <button @onclick="SetDarkTheme" style="padding: 0.75rem 1.5rem; background: #1e293b; color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;">Dark</button>
                    }
                    else
                    {
                        <button @onclick="SetDarkTheme" style="padding: 0.75rem 1.5rem; background: white; color: #64748b; border: 2px solid #e2e8f0; border-radius: 12px; font-weight: 600; cursor: pointer;">Dark</button>
                    }
                </div>
            </div>

            <div style="background: #f8fafc; padding: 2rem; border-radius: 16px; margin-bottom: 2rem;">
                <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Journal Statistics</h2>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #6366f1;">@totalEntries</div>
                        <div style="color: #64748b; font-size: 0.875rem;">Total Entries</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">@currentStreak</div>
                        <div style="color: #64748b; font-size: 0.875rem;">Current Streak</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">@avgWords</div>
                        <div style="color: #64748b; font-size: 0.875rem;">Avg Words</div>
                    </div>
                </div>
            </div>

            <div style="background: #fef2f2; padding: 2rem; border-radius: 16px; border: 2px solid #fca5a5; margin-bottom: 2rem;">
                <h2 style="font-size: 1.25rem; font-weight: 700; color: #991b1b; margin-bottom: 1rem;">Danger Zone</h2>
                <p style="color: #7f1d1d; margin-bottom: 1rem;">Delete all journal entries. This cannot be undone.</p>
                <button @onclick="DeleteAllEntries" style="padding: 0.75rem 1.5rem; background: #ef4444; color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;">Delete All Entries</button>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button @onclick="GoToDashboard" style="padding: 0.75rem 1.5rem; background: white; color: #6366f1; border: 2px solid #6366f1; border-radius: 12px; font-weight: 600; cursor: pointer;">Back to Dashboard</button>
                <button @onclick="Logout" style="padding: 0.75rem 1.5rem; background: white; color: #ef4444; border: 2px solid #ef4444; border-radius: 12px; font-weight: 600; cursor: pointer;">Logout</button>
            </div>

        </div>
    </div>
</div>

@code {
    private int totalEntries = 0;
    private int currentStreak = 0;
    private int avgWords = 0;
    private string currentTheme = "light";

    protected override void OnInitialized()
    {
        if (!JournalService.IsAuthenticated())
        {
            Navigation.NavigateTo("/login", forceLoad: true);
            return;
        }

        LoadStatistics();
        currentTheme = JournalService.GetTheme();
    }

    private void LoadStatistics()
    {
        var allEntries = JournalService.GetAllEntries();
        totalEntries = allEntries.Count;

        var streaks = JournalService.CalculateStreaks();
        currentStreak = streaks.Current;

        double avg = JournalService.GetAverageWordCount();
        avgWords = (int)avg;
    }

    private async Task SetLightTheme()
    {
        currentTheme = "light";
        JournalService.SaveTheme("light");
        await JSRuntime.InvokeVoidAsync("applyTheme", "light");
    }

    private async Task SetDarkTheme()
    {
        currentTheme = "dark";
        JournalService.SaveTheme("dark");
        await JSRuntime.InvokeVoidAsync("applyTheme", "dark");
    }

    private void DeleteAllEntries()
    {
        var entries = JournalService.GetAllEntries();
        foreach (var entry in entries)
        {
            JournalService.DeleteEntry(entry.Id);
        }
        LoadStatistics();
    }

    private void GoToDashboard()
    {
        Navigation.NavigateTo("/dashboard");
    }

    private void Logout()
    {
        JournalService.Logout();
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}
